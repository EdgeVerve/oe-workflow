/**
 *
 * Â©2016-2017 EdgeVerve Systems Limited (a fully owned Infosys subsidiary),
 * Bangalore, India. All Rights Reserved.
 *
 */

var fs = require('fs');
var path = require('path');

var bootstrap = require('./bootstrap');
var chai = bootstrap.chai;
var assert = chai.assert;
var models = bootstrap.models;
var log = bootstrap.log();

var stateVerifier = require('./utils/stateverifier');

describe('Test case for Business Rule Task', function cb() {
  this.timeout(10000);
  var name = 'businessRuleTask';
  var testVars = {};

  it('should read the file', function cb(done) {
    fs.readFile(path.resolve('./test/bpmn-files', name + '.bpmn'), 'utf8', (err, data) => {
      testVars.xmldata = data;
      done(err);
    });
  });

  it('deploy the WorkflowDefinition', function cb(done) {
    var defData = { 'name': name, 'xmldata': testVars.xmldata };
    models.WorkflowDefinition.create(defData, bootstrap.defaultContext, function cb(err) {
      // Code for duplicate keys
      if (bootstrap.checkDuplicateKeyError(err))              {done();}          else {
        done(err);
      }
    });
  });

  it('should create a new record for decision table model', function cb(done) {
    models.DecisionTable.create({
      'name': 'Adjustments',
      'document': {
        'documentName': 'Adjustments.xlsx',
        'documentData': 'data:application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;base64,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'
      }
    }, bootstrap.defaultContext, function cb(err, data) {
      if (bootstrap.checkDuplicateKeyError(err)) {
        done(err);
      } else {
        // There should not be any error while adding the new record into decision table
        done();
      }
    });
  });

  it('create workflow instance ', function cb(done) {
    var data = { 'workflowDefinitionName': name };
    models.WorkflowInstance.create(data, bootstrap.defaultContext, function cb(err, instance) {
      if (err) {
        return done(err);
      }
      testVars.mainWorkflowInstance = instance;
      setTimeout(done, 2000);
    });
  });

  it('fetch process instance', function cb(done) {
    testVars.mainWorkflowInstance.processes({}, bootstrap.defaultContext, function cb(err, instance) {
      if (err) {
        return done(err);
      }
      assert.isNotNull(instance);
      assert.lengthOf(instance, 1);
      testVars.processes = instance;
      setTimeout(done, 1000);
    });
  });

  /**
   * TODO : Disabling the test case because business rule input format seems to be change, need to update the encodede excel
   */
  it('validate process', function cb(done) {
    models.ProcessInstance.findById(testVars.processes[0].id, bootstrap.defaultContext, function cb(err, instance) {
      if (err) {
        return done(err);
      }
      log.debug(instance);
      assert.isNotNull(instance);
      assert.equal(instance._status, 'complete');
      var expectedFlow = ['Start', 'BusinessRule Task', 'Script Task', 'End'];
      stateVerifier.verifyFlow(instance._processTokens, expectedFlow);
      assert.isNotNull(instance._processVariables.ruleEngineDecision);
      assert.isNotNull(instance._processVariables.ruleEngineDecision.body);
      assert.equal(instance._processVariables.ruleEngineDecision.body.Discount, 0.05);
      assert.equal(instance._processVariables.ruleEngineDecision.body.Shipping, 'Air');
      setTimeout(done, 1000);
    });
  });
});
